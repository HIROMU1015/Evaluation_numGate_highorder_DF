from typing import List

from .config import PFLabel, normalize_pf_label


def morales_8th_list() -> List[float]:
    """Morales 8次の係数列を返す。"""
    # 係数リストを構築
    w_1to8 = [
        0.29137384767986663096528500968049,
        0.26020394234904150277316667709864,
        0.18669648149540687549831902999911,
        -0.40049110428180105319963667975074,
        0.15982762208609923217390166127256,
        -0.38400573301491401473462588779099,
        0.56148845266356446893590729572808,
        0.12783360986284110837857554950443,
    ]

    w0_1to8 = [1 - 2 * sum(w_1to8)]
    w = w0_1to8 + w_1to8
    return w


# Yoshida's 8th order product formula
def yoshida_8th_list() -> List[float]:
    """Yoshida 8次の係数列を返す。"""
    # 係数リストを構築
    w_1to7 = [
        -1.61582374150097,
        -2.44699182370524,
        -0.0071698941970812,
        2.44002732616735,
        0.157739928123617,
        1.82020630970714,
        1.04242620869991,
    ]
    w0_1to7 = [1 - 2 * sum(w_1to7)]
    # パラメータの設定
    w = w0_1to7 + w_1to7
    return w


# Mauro's 10th order product formula(m=15)
def morales_10th_m15_list() -> List[float]:
    """Morales 10次(m=15)の係数列を返す。"""
    # 係数リストを構築
    w_1to15 = [
        0.14552859955499429739088135596618,
        -0.48773512068133537309419933740564,
        0.12762011242429535909727342301656,
        0.70225450019485751220143080587959,
        -0.62035679146761710925756521405042,
        0.39099152412786178133688869373114,
        0.17860253604355465807791041367045,
        -0.80455783177921776295588528272593,
        0.053087216442758242118687385646283,
        0.86836307910275556258687030904753,
        -0.85326297197907834671536254437991,
        -0.11732457198874083224967699358383,
        0.03827345494186056632406947772047,
        0.74843529029532498233997793305357,
        0.30208715621975773712410948025906,
    ]

    w0_1to8 = [1 - 2 * sum(w_1to15)]
    # パラメータの設定
    # w_0 = 1 - 2sum(w_i)
    w = w0_1to8 + w_1to15
    return w


# Mauro's 10th order product formula(m=16)
def morales_10th_m16_list() -> List[float]:
    """Morales 10次(m=16)の係数列を返す。"""
    # 係数リストを構築
    w_1to16 = [
        -0.4945013179955571856347147977644,
        0.2904317222970121479878414292093,
        0.34781541068705330937913890281003,
        -0.98828132118546184603769781410676,
        0.98855187532756405235733957305613,
        -0.34622976933123177430694714630668,
        0.20218952619073117554714280367018,
        0.13064273069786247787208895471461,
        -0.26441199183146805554735845490359,
        0.060999140559210408869096992291531,
        -0.6855442489606141359108973267028,
        -0.15843692473786584550599206557006,
        0.15414691779958299150286452215575,
        0.66715205827214320371061839297055,
        0.20411874474696598289603677693511,
        0.081207318210272593225087711441684,
    ]

    w0 = [1 - 2 * sum(w_1to16)]
    w = w0 + w_1to16
    return w


# Yoshida's 4th order product formula
def yoshida_4th_list() -> List[float]:  # s3odr4
    """Yoshida 4次の係数列を返す。"""
    # 係数リストを構築
    w = [-1 * (2 ** (1 / 3)) / (2 - 2 ** (1 / 3)), 1 / (2 - 2 ** (1 / 3))]
    return w


def trotter_2nd_list() -> List[float]:
    """2次(Trotter)の係数列を返す。"""
    # 係数リストを構築
    w = [1.0]
    return w


def new_4th_m3_list() -> List[float]:
    """新構築 4次(m=3)の係数列を返す。"""
    # 係数リストを構築
    w1to3 = [0.40653666, 0.21638706, 0.14924614]
    w0_1to3 = [1 - 2 * sum(w1to3)]
    w = w0_1to3 + w1to3
    return w


def new_4th_m2_list() -> List[float]:
    """新構築 4次(m=2)の係数列を返す。"""
    # 係数リストを構築
    w1to2 = [0.42008729, 0.40899193]
    w0_1to3 = [1 - 2 * sum(w1to2)]
    w = w0_1to3 + w1to2
    return w


def _get_w_list(num_w: PFLabel) -> List[float]:
    """積公式パラメータ w の系列を取得（分岐を関数化）。"""
    num_w = normalize_pf_label(num_w)
    if num_w == "8th(Morales)":
        return morales_8th_list()
    if num_w == "10th(Morales)":
        return morales_10th_m16_list()
    if num_w == "4th":
        return yoshida_4th_list()
    if num_w == "8th(Yoshida)":
        return yoshida_8th_list()
    if num_w == "2nd":
        return trotter_2nd_list()
    if num_w == "4th(new_3)":
        return new_4th_m3_list()
    if num_w == "4th(new_2)":
        return new_4th_m2_list()
    raise ValueError(f"Unsupported num_w: {num_w}")
